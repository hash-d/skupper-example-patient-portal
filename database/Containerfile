FROM docker.io/library/postgres

ENV POSTGRES_USER=patient_portal
ENV POSTGRES_PASSWORD=secret
ENV POSTGRES_HOST_AUTH_METHOD=scram-sha-256
ENV POSTGRES_INITDB_ARGS=--auth-host=scram-sha-256
ENV PGDATA=/pgdata/data

COPY data.sql /docker-entrypoint-initdb.d/data.sql

# This is required for OpenShift, as the base postgres
# image runs as root
RUN mkdir /pgdata && \
    chgrp -R 0 /docker-entrypoint-initdb.d/data.sql /pgdata && \
    chmod -R g+rwX /docker-entrypoint-initdb.d/data.sql /pgdata
